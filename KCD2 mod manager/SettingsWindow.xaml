<Window x:Class="KCD2_mod_manager.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:KCD2_mod_manager"
        mc:Ignorable="d"
        Title="SettingsWindow" Height="450" Width="800"
        WindowStartupLocation="CenterOwner" ResizeMode="NoResize">
    <Window.Resources>
        <!-- Merged Theme Resources - MUST be first to provide theme brushes -->
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Themes/Theme.Common.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            
            <!-- Modern Toggle Switch Style - Kein Flicker beim Laden, sofortiger initial state -->
        <Style x:Key="SwitchToggleStyle" TargetType="ToggleButton">
            <Setter Property="Width" Value="50"/>
            <Setter Property="Height" Value="25"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Grid Width="{TemplateBinding Width}" Height="{TemplateBinding Height}">
                            <!-- Hintergrund - Theme-aware -->
                            <Border x:Name="SwitchBackground"
                                   CornerRadius="12.5"
                                   Background="{DynamicResource ToggleOffBackgroundBrush}"
                                   BorderThickness="0"/>
                            <!-- Knopf/Knob -->
                            <Ellipse x:Name="Knob"
                                   Width="21"
                                   Height="21"
                                   Fill="White"
                                   HorizontalAlignment="Left"
                                   Margin="2,2,0,2">
                                <Ellipse.RenderTransform>
                                    <TranslateTransform X="0"/>
                                </Ellipse.RenderTransform>
                            </Ellipse>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <!-- WICHTIG: Initial State ohne Animation - verhindert Flicker -->
                            <!-- Setter für sofortigen State, EnterActions nur für Animationen -->
                            <Trigger Property="IsChecked" Value="True">
                                <!-- Sofortiger State ohne Animation beim Laden -->
                                <Setter TargetName="Knob" Property="Margin" Value="27,2,0,2"/>
                                <Setter TargetName="SwitchBackground" Property="Background" Value="{DynamicResource ToggleOnBackgroundBrush}"/>
                                <!-- Animation nur bei User-Interaktion (EnterActions) -->
                                <Trigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <ThicknessAnimation Storyboard.TargetName="Knob"
                                                              Storyboard.TargetProperty="Margin"
                                                              To="27,2,0,2" Duration="0:0:0.15"/>
                                            <!-- WICHTIG: Keine ColorAnimation - Setter verwendet bereits DynamicResource -->
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.EnterActions>
                                <Trigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <ThicknessAnimation Storyboard.TargetName="Knob"
                                                              Storyboard.TargetProperty="Margin"
                                                              To="2,2,0,2" Duration="0:0:0.15"/>
                                            <!-- WICHTIG: Keine ColorAnimation - Setter verwendet bereits DynamicResource -->
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.ExitActions>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="False">
                                <Setter TargetName="Knob" Property="Margin" Value="2,2,0,2"/>
                                <Setter TargetName="SwitchBackground" Property="Background" Value="{DynamicResource ToggleOffBackgroundBrush}"/>
                            </Trigger>
                            <!-- MouseOver-Effekt -->
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="SwitchBackground" Property="Opacity" Value="0.9"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        </ResourceDictionary>
    </Window.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="20" Background="{DynamicResource WindowBackgroundBrush}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- General Settings Section -->
            <TextBlock Grid.Row="0"
                       Grid.ColumnSpan="2"
                       Text="{Binding GeneralSettingsText}"
                       FontSize="18"
                       FontWeight="SemiBold"
                       Margin="0,0,0,16"
                       Foreground="{DynamicResource TextForegroundBrush}"/>

            <!-- Enable Delete Confirmation -->
            <TextBlock Grid.Row="1"
                       Grid.Column="0"
                       Text="{Binding EnableDeleteConfirmationText}"
                       Width="220"
                       VerticalAlignment="Center"
                       Margin="0,8,16,8"
                       Foreground="{DynamicResource TextForegroundBrush}"/>
            <ToggleButton Grid.Row="1"
                          Grid.Column="1"
                          x:Name="ToggleDeleteConfirmation"
                          Style="{StaticResource SwitchToggleStyle}"
                          Width="50"
                          Height="25"
                          HorizontalAlignment="Center"
                          IsChecked="{Binding AskOnDelete}"
                          Checked="ToggleDeleteConfirmation_Checked"
                          Unchecked="ToggleDeleteConfirmation_Unchecked"/>

            <!-- Toggle Dark Mode -->
            <TextBlock Grid.Row="2"
                       Grid.Column="0"
                       Text="{Binding ToggleDarkModeText}"
                       Width="220"
                       VerticalAlignment="Center"
                       Margin="0,8,16,8"
                       Foreground="{DynamicResource TextForegroundBrush}"/>
            <ToggleButton Grid.Row="2"
                          Grid.Column="1"
                          x:Name="ToggleDarkMode"
                          Style="{StaticResource SwitchToggleStyle}"
                          Width="50"
                          Height="25"
                          HorizontalAlignment="Center"
                          IsChecked="{Binding IsDarkMode}"
                          Checked="ToggleDarkMode_Checked"
                          Unchecked="ToggleDarkMode_Unchecked"/>

            <!-- Toggle Devmode -->
            <TextBlock Grid.Row="3"
                       Grid.Column="0"
                       Text="{Binding ToggleDevModeText}"
                       Width="220"
                       VerticalAlignment="Center"
                       Margin="0,8,16,8"
                       Foreground="{DynamicResource TextForegroundBrush}"/>
            <ToggleButton Grid.Row="3"
                          Grid.Column="1"
                          x:Name="ToggleDevMode"
                          Style="{StaticResource SwitchToggleStyle}"
                          Width="50"
                          Height="25"
                          HorizontalAlignment="Center"
                          IsChecked="{Binding IsDevMode}"
                          Checked="ToggleDevMode_Checked"
                          Unchecked="ToggleDevMode_Unchecked"/>

            <!-- Toggle Update Notifications -->
            <TextBlock Grid.Row="4"
                       Grid.Column="0"
                       Text="{Binding ToggleUpdateNotificationsText}"
                       Width="220"
                       VerticalAlignment="Center"
                       Margin="0,8,16,8"
                       Foreground="{DynamicResource TextForegroundBrush}"/>
            <ToggleButton Grid.Row="4"
                          Grid.Column="1"
                          x:Name="ToggleUpdateNotifications"
                          Style="{StaticResource SwitchToggleStyle}"
                          Width="50"
                          Height="25"
                          HorizontalAlignment="Center"
                          IsChecked="{Binding EnableUpdateNotifications}"
                          Checked="ToggleUpdateNotifications_Checked"
                          Unchecked="ToggleUpdateNotifications_Unchecked"/>

            <!-- Toggle Mod Order Creation -->
            <TextBlock Grid.Row="5"
                       Grid.Column="0"
                       Text="{Binding ToggleModOrderCreationText}"
                       Width="220"
                       VerticalAlignment="Center"
                       Margin="0,8,16,8"
                       Foreground="{DynamicResource TextForegroundBrush}"/>
            <ToggleButton Grid.Row="5"
                          Grid.Column="1"
                          x:Name="ToggleModOrderCreation"
                          Style="{StaticResource SwitchToggleStyle}"
                          Width="50"
                          Height="25"
                          HorizontalAlignment="Center"
                          IsChecked="{Binding ModOrderEnabled}"
                          Checked="ToggleModOrderCreation_Checked"
                          Unchecked="ToggleModOrderCreation_Unchecked"/>

            <!-- Enable File Renaming -->
            <TextBlock Grid.Row="6"
                       Grid.Column="0"
                       Text="{Binding EnableFileRenamingText}"
                       Width="220"
                       VerticalAlignment="Center"
                       Margin="0,8,16,8"
                       Foreground="{DynamicResource TextForegroundBrush}"
                       ToolTip="{Binding EnableFileRenamingTooltip}"/>
            <ToggleButton Grid.Row="6"
                          Grid.Column="1"
                          x:Name="ToggleFileRenaming"
                          Style="{StaticResource SwitchToggleStyle}"
                          Width="50"
                          Height="25"
                          HorizontalAlignment="Center"
                          IsChecked="{Binding EnableFileRenaming}"
                          ToolTip="{Binding EnableFileRenamingTooltip}"
                          Checked="ToggleFileRenaming_Checked"
                          Unchecked="ToggleFileRenaming_Unchecked"/>

            <!-- Allow Workshop Actions -->
            <TextBlock Grid.Row="7"
                       Grid.Column="0"
                       Text="{Binding AllowWorkshopModActionsText}"
                       Width="220"
                       VerticalAlignment="Center"
                       Margin="0,8,16,8"
                       Foreground="{DynamicResource TextForegroundBrush}"
                       ToolTip="{Binding AllowWorkshopModActionsTooltip}"/>
            <ToggleButton Grid.Row="7"
                          Grid.Column="1"
                          x:Name="ToggleWorkshopActions"
                          Style="{StaticResource SwitchToggleStyle}"
                          Width="50"
                          Height="25"
                          HorizontalAlignment="Center"
                          IsChecked="{Binding AllowWorkshopModActions}"
                          ToolTip="{Binding AllowWorkshopModActionsTooltip}"
                          Checked="ToggleWorkshopActions_Checked"
                          Unchecked="ToggleWorkshopActions_Unchecked"/>

            <!-- Separator -->
            <Separator Grid.Row="8"
                      Grid.ColumnSpan="2"
                      Margin="0,20,0,16"
                      Background="{DynamicResource SeparatorBrush}"/>

            <!-- Language Settings Section -->
            <TextBlock Grid.Row="9"
                       Grid.ColumnSpan="2"
                       Text="{Binding LanguageSettingsText}"
                       FontSize="18"
                       FontWeight="SemiBold"
                       Margin="0,0,0,16"
                       Foreground="{DynamicResource TextForegroundBrush}"/>

            <!-- Language Selection -->
            <TextBlock Grid.Row="10"
                       Grid.Column="0"
                       Text="{Binding LanguageText}"
                       Width="220"
                       VerticalAlignment="Center"
                       Margin="0,8,16,8"
                       Foreground="{DynamicResource TextForegroundBrush}"/>
            <ComboBox Grid.Row="10"
                     Grid.Column="1"
                     x:Name="LanguageComboBox"
                     Width="150"
                     Height="28"
                     HorizontalAlignment="Center"
                     SelectedValue="{Binding SelectedLanguage}"
                     ItemsSource="{Binding AvailableLanguages}"
                     DisplayMemberPath="Value"
                     SelectedValuePath="Key"
                     IsEditable="False"
                     IsHitTestVisible="True"
                     Focusable="True"
                     SelectionChanged="LanguageComboBox_SelectionChanged"/>

            <!-- Separator -->
            <Separator Grid.Row="11"
                      Grid.ColumnSpan="2"
                      Margin="0,20,0,16"
                      Background="{DynamicResource SeparatorBrush}"/>

            <!-- Backup Settings Section -->
            <TextBlock Grid.Row="12"
                       Grid.ColumnSpan="2"
                       Text="{Binding BackupSettingsText}"
                       FontSize="18"
                       FontWeight="SemiBold"
                       Margin="0,0,0,16"
                       Foreground="{DynamicResource TextForegroundBrush}"/>

            <!-- Toggle Backup Creation -->
            <TextBlock Grid.Row="13"
                       Grid.Column="0"
                       Text="{Binding ToggleBackupCreationText}"
                       Width="220"
                       VerticalAlignment="Center"
                       Margin="0,8,16,8"
                       Foreground="{DynamicResource TextForegroundBrush}"/>
            <ToggleButton Grid.Row="13"
                          Grid.Column="1"
                          x:Name="ToggleBackupCreation"
                          Style="{StaticResource SwitchToggleStyle}"
                          Width="50"
                          Height="25"
                          HorizontalAlignment="Center"
                          IsChecked="{Binding CreateBackup}"
                          Checked="ToggleBackupCreation_Checked"
                          Unchecked="ToggleBackupCreation_Unchecked"/>

            <!-- Backup on Startup -->
            <TextBlock Grid.Row="14"
                       Grid.Column="0"
                       Text="{Binding BackupOnStartupText}"
                       Width="220"
                       VerticalAlignment="Center"
                       Margin="0,8,16,8"
                       Foreground="{DynamicResource TextForegroundBrush}"/>
            <ToggleButton Grid.Row="14"
                          Grid.Column="1"
                          x:Name="ToggleBackupOnStartup"
                          Style="{StaticResource SwitchToggleStyle}"
                          Width="50"
                          Height="25"
                          HorizontalAlignment="Center"
                          IsChecked="{Binding BackupOnStartup}"
                          Checked="ToggleBackupOnStartup_Checked"
                          Unchecked="ToggleBackupOnStartup_Unchecked"/>

            <!-- Set Max Backups -->
            <TextBlock Grid.Row="15"
                       Grid.Column="0"
                       Text="{Binding SetMaxBackupsText}"
                       Width="220"
                       VerticalAlignment="Center"
                       Margin="0,8,16,8"
                       Foreground="{DynamicResource TextForegroundBrush}"/>
            <Button Grid.Row="15"
                    Grid.Column="1"
                    Content="{Binding SetButtonText}" 
                    Click="SetMaxBackups_Click" 
                    Width="80" 
                    Height="32" 
                    HorizontalAlignment="Center"
                    Style="{StaticResource SecondaryButtonStyle}"/>

        </Grid>
    </ScrollViewer>
</Window>